<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Phase 0, Structures - Lurch Deductive Engine Documentation</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Lurch Deductive Engine Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Home</a>
                    </li>
                    <li >
                        <a href="../overview/">Overview</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Phases <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li class="active">
    <a href="./">Phase 0, Structures</a>
</li>
                            
<li >
    <a href="../phase1-validation/">Phase 1, Basic Validation</a>
</li>
                            
<li >
    <a href="../phase1a-client/">Phase 1A, The Client</a>
</li>
                            
<li >
    <a href="../phase1b-dependencies/">Phase 1B, Dependencies</a>
</li>
                            
<li >
    <a href="../phase1c-background/">Phase 1C, Background Queue</a>
</li>
                            
<li >
    <a href="../phase2-strings/">Phase 2, String Matching</a>
</li>
                            
<li >
    <a href="../phase3-theorems/">Phase 3, Theorems and Proofs</a>
</li>
                            
<li >
    <a href="../phase4-expressions/">Phase 4, Expression Trees</a>
</li>
                            
<li >
    <a href="../phase5-parsing/">Phase 5, Parsing Rules</a>
</li>
                            
<li >
    <a href="../phase6-declarations/">Phase 6, Declarations</a>
</li>
                            
<li >
    <a href="../phase7-features/">Phase 7, Bonus Features</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../ideas/">Ideas Archive</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../overview/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../phase1-validation/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#lde-design-phase-0-structures">LDE Design Phase 0: Structures</a></li>
            <li><a href="#the-structure-module">The Structure module</a></li>
            <li><a href="#lde-module">LDE Module</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="lde-design-phase-0-structures">LDE Design Phase 0: Structures</h1>
<p>All the later phases will actually implement stuff that we could use to
make real documents and libraries.  This one doesn't, so it's called
Phase 0.</p>
<p>In this phase, we just design the generic Structure class on which everything else will depend, and the infrastructure of the LDE itself.</p>
<p>At the end of this phase, we could write unit tests of the whole Structure class and its LDE context, thus guaranteeing that all later phases rest on a good foundation.</p>
<h2 id="the-structure-module">The Structure module</h2>
<p>That module defines a single <code>Structure</code> class, whose instances have these
methods.</p>
<h3 id="computed-attributes">Computed attributes</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled checked> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li><code>S.setComputedAttribute(key,value)</code> caches a computed value under a
   certain key<ul>
<li>One important example of a computed attribute:</li>
<li><code>S.setComputedAttribute("feedback",obj)</code> tells the UI the type of
  feedback it should show for structure S, with obj having these keys:<ul>
<li>result: a string, either "valid" or "invalid" or "indeterminate"</li>
<li>message: a string, the message should be shown on hover of the
  feedback indicator</li>
<li>section: (optional) which character (or range of characters) are
  the specific ones on which the feedback focuses.<ul>
<li>For instance, if something doesn't parse, you might want to
  point out where it failed.</li>
<li>Or if an expression parses into many steps of work, each of
  which gets validated separately, then the feedback needs to
  be localized.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>S.getComputedAttribute(key)</code> fetches the computed attribute value, or
   returns undefined if it's not stored</li>
<li><code>S.clearComputedAttributes(key1,key2,...)</code> removes the computed values;
   calling it with no arguments removes all computed values</li>
<li><code>S.compute(key1,key2,...)</code> runs whatever function is necessary to
   compute and store the attributes for the keys.<ul>
<li>It should usually be obvious what this is from context, like if S has
  a function <code>S.meaning()</code> and we say <code>S.compute("meaning")</code> that means
  run <code>S.setComputedAttribute("meaning",S.meaning())</code>.</li>
<li>In fact, the base implementation in the structure class does exactly
  what is described in the previous bullet point; <code>S.compute(k)</code> runs
  <code>S[k]()</code> and stores the result.  To pass parameters, instead of a
  string key, pass an array <code>[key,arg1,arg2,...]</code>.</li>
<li>But more complex examples are possible, and each structure type is in
  charge of implementing <code>compute()</code> in the appropriate way.</li>
</ul>
</li>
</ul>
<h3 id="external-attributes">External attributes</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled checked> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<p>Just as computed attributes are a key-value dictionary, so are external
attributes.  However, we keep them separate because computed attributes are
those created by the LDE itself, internally, as the result fo some
computation on the structure, but external attributes are provided by the
client of this module, and are not altered by the LDE.</p>
<p>Thus we have the same three functions for manipulating the key-value
dictionary (get/set/clear) but no corresponding <code>compute</code> function.</p>
<ul>
<li><code>S.setExternalAttribute(key,value)</code> stores a value under a given key.</li>
<li><code>S.getExternalAttribute(key)</code> fetches the attribute value, or returns
   undefined if it's not stored.</li>
<li><code>S.clearExternalAttributes(key1,key2,...)</code> removes the stored values;
   calling it with no arguments removes all stored values.</li>
</ul>
<h3 id="manipulating-the-structure-hierarchy">Manipulating the structure hierarchy</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled checked> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li><code>new Structure(arg1,arg2,...)</code> creates a structure with the given list of
   child structures.</li>
<li><code>S.children()</code> yields an ordered array of structures immediately
   inside S</li>
<li><code>S.parent()</code> yields the parent structure of S, or undefined if S is
   the LDE Document root</li>
<li><code>S.indexInParent()</code> gives the index of S in its parent's children array.</li>
<li><code>S.insertChild(child,index)</code> inserts a new child at the given index,
   removing it from its old parent, if there was one.</li>
<li><code>S.removeChild(index)</code> does the reverse.</li>
<li><code>S.removeFromParent()</code> calls <code>P.removeChild(index)</code> in the parent of S,
   passing <code>S.indexInParent()</code>.</li>
<li><code>S.replaceWith(other)</code> replaces S, where it sits in the hierarchy, with
   a different structure, thus leaving S with no parent.</li>
</ul>
<h3 id="event-handling-in-the-structure-hierarchy">Event handling in the structure hierarchy</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled checked> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<p>Each of the following functions will be called by the functions above, when
the event is complete.  There is no default implementation of each of these
functions, which means that no call will take place.  However, any instance
or subclass may choose to implement one or more of these functions as event
handlers, and thus hear about the events they signal.</p>
<ul>
<li><code>S.wasInserted()</code> will be called in any structure inserted into any
   parent structure, including just-constructed structures being inserted
   into a parent for the first time.  It is called after the insertion, so
   <code>S.parent()</code> will yield a valid <code>Structure</code> instance.</li>
<li><code>S.wasRemoved(parent,index)</code> will be called immediately after S is
   removed from its previous parent (but obviously S has not yet been
   deleted from JavaScript memory).  The first parameter will be the former
   parent structure (which will still exist, because the removal juts
   happened) and the index that S formerly had within that parent.  Note
   that replacing one structure with another will yield a call to
   <code>S.wasRemoved()</code> in the one structure and <code>S.wasInserted()</code> in the other.</li>
<li><code>S.wasChanged()</code> is a function that the UI will call in a structure if
   one of the structure's computd or external attributes changed.</li>
</ul>
<h3 id="unique-ids">Unique IDs</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li>Establish a global mapping from unique Structure IDs to the instances
   that have those IDs; update this (and the list of free IDs) in the
   Structure constructor.</li>
<li>Create a class function for finding the instance with a given ID, if any.</li>
</ul>
<h3 id="connections">Connections</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li>Assume that two special external attribute keys will be "connectionsOut"
   and "connectionsIn," each a set of targetID-connectionType pairs.  These
   are assumed to be kept consistent across a hierarchy, in that any
   connections out from one node also exist as connections in for all the
   target nodes.</li>
<li>Create convenience getter and setter functions for this data.<ul>
<li>Create/delete a connection of type T between A and B.</li>
<li>Get all connections of type T to/from A.</li>
<li>Get all connections to/from A.</li>
<li>Get all connections from A to B.</li>
</ul>
</li>
<li><code>S.properties()</code> looks at the set of other structures that connect to S
   via arrows, and forms a dictionary of name=value pairs, the "properties"
   of S.</li>
</ul>
<h3 id="convenience-constructions-for-unit-testing">Convenience constructions for unit testing</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li>Create <code>S.attr(obj)</code> that will add as external attributes all key-value
   pairs in <code>obj</code>, returning <code>S</code> for use in hierarchy-building.</li>
<li>Append to the constructor code that traverses the tree and attempts to
   make connectionsOut attributes consistent with connectionsIn attributes,
   in a full tree traversal.</li>
<li>Enhance that tree traversal so that it finds attributes with common
   connection-type keys ("reason for", "premise for", etc.) and converts
   them into connectionsOut members before doing the consistency checking.
   E.g., <code>S.attr({"reason for":3})</code>.</li>
<li>Enhance that further so that the value associated with such a key can be
   a string from among a small set of relative references, such as
   "previous" and "next."  E.g., <code>S.attr({"reason for":"previous"})</code>.</li>
</ul>
<h3 id="accessibility">Accessibility</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li><code>S.isAccessibleTo(T)</code> returns true or false, implementing the
   accessibility relation defined earlier.</li>
<li><code>S.findCited(n)</code> finds the first structure <code>T</code> accessible to <code>S</code> with
   name <code>n</code> in <code>T.attributes()</code>, or undefined if there is no such structure
   <code>T</code>.</li>
<li><code>S.whatCitesMe()</code> finds all structures <code>T</code> in the scope of <code>S</code> with any
   citation-based key (such as "reason" or "premise") in <code>T.properties()</code>
   begin associated to the value <code>S.properties().name</code>.</li>
<li>There may be a need later to create other accessibility-related
   routines, such as <code>S.allAccessibleToMe()</code> or <code>S.myScope()</code> or
   <code>S.allAccessibleSatisfying(P)</code> etc.</li>
</ul>
<h3 id="miscellany">Miscellany</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li><code>S.text()</code> returns the contents of <code>S</code> as plain text.  The default
   implementation of this, for the base <code>Structure</code> class, is the empty
   string.  Subclasses may override this, but there is a guaranteed
   implementation in all <code>Structure</code>s that yields a string.</li>
</ul>
<h2 id="lde-module">LDE Module</h2>
<h3 id="global-functions-and-data">Global functions and data</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<ul>
<li>Defines global functions for serializing and dezerializing Structure
   instances (or subclass instances) to/from JSON data.  The important half
   of this pair is deserialization, but to help with testing, it makes sense
   to also create a corresponding serializer.</li>
<li>Create a global Structure that is the LDE Document.  It will be a
   generic Structure, not a subclass.  It will have no children; they
   can be added later.  That is, it starts as a one-node tree, root only.</li>
</ul>
<h3 id="foregroundbackground">Foreground/background</h3>
<p>Work done in this section:</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> Code implemented</li>
<li class="task-list-item"><input type="checkbox" disabled> Unit tests written and passing</li>
<li class="task-list-item"><input type="checkbox" disabled> API documentation written</li>
</ul>
<p>Specification:</p>
<p>If the LDE detects that it is being run in a background thread, it will set
up listeners for messages from the parent thread.  These listeners will
handle messages of three types:</p>
<ul>
<li>Insert a new subtree.<ul>
<li>The message must include the unique ID of the parent, the index at
  which the subtree will be inserted, and all the data defining the
  subtree (serialized in JSON form, as required for transmission to
  JavaScript background threads).</li>
<li>If the Structure (once it's deserialized) doesn't have an ID, give it
  a new, unique one as determined by the global mapping, and insert the
  new (id,instance) pair into that mapping</li>
</ul>
</li>
<li>Delete an existing subtree.  The message must include the unique ID of
   the tree to delete.  Remove it from the global ID mapping as well and
   erase its ID attribute.</li>
<li>Replace a subtree with a new one.  The message must include the unique
   ID of the tree to replace and the data defining the replacement
   (serialized as just described).  Remove the replaced one from the global
   ID mapping as well and erase its ID attribute.</li>
</ul>
<p>Even if it is not being run in a background thread (but perhaps was loaded
as a module in some command-line app, for instance) it will still expose
insert, delete, and replace functions as part of the module's API, each of
which operate on the global LDE document.</p>
<p>We will call any kind of insertion, removal, or replacement of subtrees of
the LDE Document a change event, whether it happened via a message from a
parent thread or as a function call to the LDE as a module in a larger app.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script src="../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
