var InnerScriptPath,LDEWorker,Worker;"undefined"==typeof require||null===require||void 0!==Worker&&null!==Worker?InnerScriptPath="worker-internal.js":(Worker=require("webworker-threads").Worker,InnerScriptPath="release/worker-internal.js"),LDEWorker=function(){function t(t){this.callbacks={},this.loadedCallbacks=[],this.setup(t)}return t.prototype.saveCallback=function(t){var e;for(e=0;this.callbacks.hasOwnProperty(e);)e++;return this.callbacks[e]=t,e},t.prototype.runAndClearCallback=function(t){var e;return e=this.callbacks[t.id],delete this.callbacks[t.id],delete t.id,"function"==typeof e?e(t):void 0},t.prototype.setup=function(t){return this.worker=new Worker(InnerScriptPath),this.whenReady(t),this.worker.addEventListener("message",function(e){return function(n){var r,o,i;if("loaded"===n.data.type){for(r=0,o=(i=e.loadedCallbacks).length;r<o;r++)(t=i[r])(e);return e.loadedCallbacks=[]}return e.runAndClearCallback(n.data)}}(this))},t.prototype.isReady=function(){return 0===this.loadedCallbacks.length},t.prototype.whenReady=function(t){return this.isReady()?"function"==typeof t?t(this):void 0:t?this.loadedCallbacks.push(t):void 0},t.prototype.dispatch=function(t,e){return t.id=this.saveCallback(e),this.worker.postMessage(t)},t.prototype.run=function(e,n){return"function"==typeof e&&(e="("+t.functionToCode(e)+")()"),this.dispatch({type:"run",code:e},n)},t.functionToCode=function(t){var e;return e=""+t,null!=t.name&&t.name.length>0&&e.slice(0,t.name.length)===t.name&&(e="function "+e.slice(t.name.length)),e},t.prototype.runAsync=function(e,n){return"function"==typeof e&&(e="("+t.functionToCode(e)+")"),this.dispatch({type:"runAsync",function:e},n)},t.prototype.installScript=function(t,e){return this.dispatch({type:"install script",filename:t},e)},t.prototype.installFunction=function(t,e,n){var r,o;return e=""+e,r=e.substring(e.indexOf("(")+1,e.indexOf(")")),o=e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),this.dispatch({type:"install function",name:t,arguments:r,body:o},n)},t.prototype.installData=function(t,e,n){return this.dispatch({type:"install data",name:t,data:e},n)},t.prototype.uninstallData=function(t,e){return this.dispatch({type:"uninstall data",name:t},e)},t.prototype.reboot=function(t){var e;return null!=(e=this.worker)&&e.terminate(),this.setup(t)},t}(),"undefined"!=typeof exports&&null!==exports&&(exports.LDEWorker=LDEWorker);
//# sourceMappingURL=worker.js.map
