var InnerScriptPath,LDEWorker,Worker;"undefined"==typeof require||null===require||void 0!==Worker&&null!==Worker?InnerScriptPath="worker-internal.js":(Worker=require("webworker-threads").Worker,InnerScriptPath="release/worker-internal.js"),LDEWorker=function(){function t(t){this.callbacks={},this.loadedCallbacks=[],this.setup(t)}return t.prototype.saveCallback=function(t){var e;for(e=0;this.callbacks.hasOwnProperty(e);)e++;return this.callbacks[e]=t,e},t.prototype.runAndClearCallback=function(t){var e;return e=this.callbacks[t.id],delete this.callbacks[t.id],delete t.id,"function"==typeof e?e(t):void 0},t.prototype.setup=function(t){return this.worker=new Worker(InnerScriptPath),this.whenReady(t),this.worker.addEventListener("message",function(e){return function(r){var n,a,i;if("loaded"===r.data.type){for(n=0,a=(i=e.loadedCallbacks).length;n<a;n++)(t=i[n])(e);return e.loadedCallbacks=[]}return e.runAndClearCallback(r.data)}}(this))},t.prototype.isReady=function(){return 0===this.loadedCallbacks.length},t.prototype.whenReady=function(t){return this.isReady()?"function"==typeof t?t(this):void 0:t?this.loadedCallbacks.push(t):void 0},t.prototype.dispatch=function(t,e){return t.id=this.saveCallback(e),this.worker.postMessage(t)},t.prototype.run=function(t,e){return"function"==typeof t&&(t="("+t+")()"),this.dispatch({type:"run",code:t},e)},t.prototype.runAsync=function(t,e){return"function"==typeof t&&(t="("+t+")"),this.dispatch({type:"runAsync",function:t},e)},t.prototype.installScript=function(t,e){return this.dispatch({type:"install script",filename:t},e)},t.prototype.installFunction=function(t,e,r){var n,a;return e=""+e,n=e.substring(e.indexOf("(")+1,e.indexOf(")")),a=e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),this.dispatch({type:"install function",name:t,arguments:n,body:a},r)},t.prototype.installData=function(t,e,r){return this.dispatch({type:"install data",name:t,data:e},r)},t.prototype.uninstallData=function(t,e){return this.dispatch({type:"uninstall data",name:t},e)},t.prototype.reboot=function(t){var e;return null!=(e=this.worker)&&e.terminate(),this.setup(t)},t}(),"undefined"!=typeof exports&&null!==exports&&(exports.LDEWorker=LDEWorker);
//# sourceMappingURL=worker.js.map
