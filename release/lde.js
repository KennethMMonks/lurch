var EventEmitter,Feedback,InputModifier,InputStructure,InputTree,OutputStructure,OutputTree,Structure,className,classObj,deserializeIfNeeded,expectedArgumentCount,feedback,functions,isInTheInputTree,key,ref,ref1,value,hasProp={}.hasOwnProperty,slice=[].slice,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};if("undefined"!=typeof require&&null!==require?(Structure=require("./structure").Structure,ref=require("./input-structure"),InputStructure=ref.InputStructure,InputModifier=ref.InputModifier,OutputStructure=require("./output-structure").OutputStructure):"undefined"!=typeof WorkerGlobalScope&&null!==WorkerGlobalScope?(importScripts("structure.js"),importScripts("input-structure.js"),importScripts("output-structure.js")):null!=("undefined"!=typeof self&&null!==self?self.importScripts:void 0)&&(importScripts("release/structure.js"),importScripts("release/input-structure.js"),importScripts("release/output-structure.js")),InputTree=null,functions={},functions.getInputTree=function(){return InputTree},OutputTree=null,functions.getOutputTree=function(){return OutputTree},functions.getInternalState=function(){return{inputTree:InputTree.toJSON(),outputTree:OutputTree.toJSON()}},functions.setInternalState=function(e){return null!=InputTree&&InputTree.untrackIDs(),(InputTree=Structure.fromJSON(e.inputTree)).trackIDs(),null!=OutputTree&&OutputTree.untrackIDs(),(OutputTree=Structure.fromJSON(e.outputTree)).trackIDs()},functions.reset=function(){return functions.setInternalState({inputTree:{className:"InputStructure",children:[],attributes:{id:"root"}},outputTree:{className:"OutputStructure",children:[],attributes:{id:"OT root"}}})},functions.reset(),isInTheInputTree=function(e){for(;e instanceof InputStructure;){if(e===InputTree)return!0;e=e.parent()}return!1},deserializeIfNeeded=function(e){return e instanceof InputStructure?e:Structure.fromJSON(e)},functions.insertStructure=function(e,t,n){var r,u,i,c;if(null!=(c=Structure.instanceWithID(t))&&0<=n&&n<=c.children().length&&isInTheInputTree(c)&&null!=(i=deserializeIfNeeded(e))&&i instanceof InputStructure)return(r=function(){var e,t;e=i.attributes,t=[];for(u in e)hasProp.call(e,u)&&"_"===u[0]&&t.push(u);return t}()).length>0&&i.clearAttributes.apply(i,r),c.insertChild(i,n),i.trackIDs()},functions.deleteStructure=function(e){var t;if(null!=(t=Structure.instanceWithID(e))&&isInTheInputTree(t)&&t!==InputTree)return t.removeFromParent(),t.untrackIDs()},functions.replaceStructure=function(e,t,n){var r,u,i,c;if(null==n&&(n=!1),null!=(c=Structure.instanceWithID(e))&&isInTheInputTree(c)&&c!==InputTree&&null!=(i=deserializeIfNeeded(t))&&i instanceof InputStructure)return(r=function(){var e,t;e=i.attributes,t=[];for(u in e)hasProp.call(e,u)&&"_"===u[0]&&t.push(u);return t}()).length>0&&i.clearAttributes.apply(i,r),c.replaceWith(i),n&&c.transferConnectionsTo(i),c.untrackIDs(),i.trackIDs()},functions.setStructureAttribute=function(e,t,n){var r;if("_"!==t[0])return null!=(r=Structure.instanceWithID(e))&&isInTheInputTree(r)&&("id"===t&&r.untrackIDs(!1),void 0===n?r.clearAttributes(t):r.setAttribute(t,n),"id"===t)?r.trackIDs(!1):void 0},functions.insertConnection=function(e,t,n){var r,u;return!!((r=Structure.instanceWithID(e))&&(u=Structure.instanceWithID(t))&&isInTheInputTree(r)&&isInTheInputTree(u))&&Structure.connect(r,u,n)},functions.removeConnection=function(e){return!(!isInTheInputTree(Structure.getConnectionSource(e))||!isInTheInputTree(Structure.getConnectionTarget(e)))&&Structure.disconnect(e)},functions.setConnectionAttribute=function(e,t,n){return!(!isInTheInputTree(Structure.getConnectionSource(e))||!isInTheInputTree(Structure.getConnectionTarget(e)))&&Structure.setConnectionData(e,t,n)},functions.runModification=function(e){var t;return(t=function(e){var n,r,u,i,c;for(e instanceof InputModifier&&e.updateConnections(),c=[],r=0,u=(i=e.children()).length;r<u;r++)n=i[r],c.push(t(n));return c})(InputTree),e()},("undefined"!=typeof WorkerGlobalScope&&null!==WorkerGlobalScope||null!=("undefined"!=typeof self&&null!==self?self.importScripts:void 0))&&(expectedArgumentCount={insertStructure:[3],deleteStructure:[1],replaceStructure:[2,3],setStructureAttribute:[2,3],insertConnection:[3],removeConnection:[1],setConnectionAttribute:[2,3],getInputTree:[0],getOutputTree:[0],getInternalState:[0],setInternalState:[1],reset:[0],runModification:[0]},self.addEventListener("message",function(e){var t,n,r,u,i,c,s,o;if(i=e.data,n=i[0],t=2<=i.length?slice.call(i,1):[],c=t.length,indexOf.call(null!=(s=expectedArgumentCount[n])?s:[],c)>=0&&("getInputTree"===n?self.postMessage({type:"getInputTree",payload:functions.getInputTree().toJSON()}):"getOutputTree"===n?self.postMessage({type:"getOutputTree",payload:functions.getOutputTree().toJSON()}):functions[n].apply(functions,t)),"sendFeedback"===n)return u=t[0],r=t[1],null!=(null!=(o=Structure.instanceWithID(u))?o.feedback:void 0)?o.feedback(r):self.postMessage("No such Structure: "+u)})),"undefined"!=typeof window&&null!==window&&"undefined"!=typeof EventTarget&&null!==EventTarget&&(Feedback=window.Feedback=new EventTarget),"undefined"!=typeof require&&null!==require&&"undefined"!=typeof exports&&null!==exports&&(EventEmitter=require("events"),(Feedback=exports.Feedback=new EventEmitter).addEventListener=Feedback.addListener),feedback=function(e){var t;return null!=(null!=Feedback?Feedback.dispatchEvent:void 0)?(t=new Event("feedback"),t.data=e,Feedback.dispatchEvent(t)):null!=(null!=Feedback?Feedback.emit:void 0)?Feedback.emit("feedback",e):null!=("undefined"!=typeof self&&null!==self?self.postMessage:void 0)?self.postMessage({type:"feedback",payload:e}):void 0},Structure.feedback=feedback,"undefined"!=typeof exports&&null!==exports){ref1=Structure.prototype.subclasses;for(className in ref1)hasProp.call(ref1,className)&&(classObj=ref1[className],exports[className]=classObj);for(key in functions)hasProp.call(functions,key)&&(value=functions[key],exports[key]=functions[key])}
//# sourceMappingURL=lde.js.map
