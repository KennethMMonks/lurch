var LDEDocument,Structure,expectedArgumentCount,externalIDToStructure,functions,isInTheDocument,lookupID,releaseAllIDs,stopTrackingExternalIDs,trackExternalIDs,slice=[].slice;"undefined"!=typeof require&&null!==require?Structure=require("./structure").Structure:"undefined"!=typeof WorkerGlobalScope&&null!==WorkerGlobalScope?importScripts("structure.js"):null!=("undefined"!=typeof self&&null!==self?self.importScripts:void 0)&&importScripts("release/structure.js"),(LDEDocument=new Structure).getID(),(functions={}).getDocument=function(){return LDEDocument},isInTheDocument=function(e){for(;e instanceof Structure;){if(e===LDEDocument)return!0;e=e.parent()}return!1},releaseAllIDs=function(e){var t,n,r,u,l;for(e.releaseID(),l=[],n=0,r=(u=e.children()).length;n<r;n++)t=u[n],l.push(releaseAllIDs(t));return l},externalIDToStructure={},trackExternalIDs=function(e,t){var n,r,u,l,o,s;if(null==t&&(t=!0),null!=(u=e.getExternalAttribute("ID"))&&(externalIDToStructure[u]=e),t){for(s=[],r=0,l=(o=e.children).length;r<l;r++)n=o[r],s.push(trackExternalIDs(n));return s}},stopTrackingExternalIDs=function(e,t){var n,r,u,l,o,s;if(null==t&&(t=!0),null!=(u=e.getExternalAttribute("ID"))&&delete externalIDToStructure[u],t){for(s=[],r=0,l=(o=e.children).length;r<l;r++)n=o[r],s.push(stopTrackingExternalIDs(n));return s}},lookupID=function(e){return"root"===e?functions.getDocument():"number"==typeof e?Structure.instanceWithID(e):externalIDToStructure[e]},functions.insert=function(e,t,n){var r,u;if(null!=(u=lookupID(t))&&0<=n&&n<=u.children().length&&isInTheDocument(u)&&null!=(r=Structure.fromJSON(e).setup()))return u.insertChild(r,n),trackExternalIDs(r)},functions.delete=function(e){var t;if(null!=(t=lookupID(e))&&isInTheDocument(t)&&t!==LDEDocument)return t.removeFromParent(),releaseAllIDs(t),stopTrackingExternalIDs(t)},functions.replace=function(e,t){var n,r;if(null!=(r=lookupID(e))&&isInTheDocument(r)&&r!==LDEDocument&&null!=(n=Structure.fromJSON(t).setup()))return r.replaceWith(n),releaseAllIDs(r),trackExternalIDs(n),stopTrackingExternalIDs(r)},functions.setAttribute=function(e,t,n){var r;if(null!=(r=lookupID(e))&&isInTheDocument(r)&&("ID"===t&&stopTrackingExternalIDs(r,!1),r.setExternalAttribute(t,n),"ID"===t))return trackExternalIDs(r,!1)},("undefined"!=typeof WorkerGlobalScope&&null!==WorkerGlobalScope||null!=("undefined"!=typeof self&&null!==self?self.importScripts:void 0))&&(expectedArgumentCount={insert:3,delete:1,replace:2,setAttribute:3,getDocument:0},self.addEventListener("message",function(e){var t,n,r;if(r=e.data,n=r[0],t=2<=r.length?slice.call(r,1):[],expectedArgumentCount[n]===t.length)return"getDocument"===n?self.postMessage(functions.getDocument().toJSON()):functions[n].apply(functions,t)})),"undefined"!=typeof exports&&null!==exports&&(exports.Structure=Structure,exports.insert=functions.insert,exports.delete=functions.delete,exports.replace=functions.replace,exports.setAttribute=functions.setAttribute,exports.getDocument=functions.getDocument);
//# sourceMappingURL=lde.js.map
