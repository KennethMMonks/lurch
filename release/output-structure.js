var InputStructure,OM,OutputExpression,OutputStructure,Structure,extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,slice=[].slice,indexOf=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};"undefined"!=typeof require&&null!==require?(Structure=require("./structure").Structure,InputStructure=require("./input-structure").InputStructure,OM=require("openmath-js").OM):"undefined"!=typeof WorkerGlobalScope&&null!==WorkerGlobalScope?null==WorkerGlobalScope.Structure&&(importScripts("structure.js"),importScripts("input-structure.js"),importScripts("openmath.js")):null!=("undefined"!=typeof self&&null!==self?self.importScripts:void 0)&&null==self.Structure&&(importScripts("release/structure.js"),importScripts("release/input-structure.js"),importScripts("node_modules/openmath-js/openmath.js")),OutputStructure=function(t){function e(){var t,r,n;e.__super__.constructor.apply(this,arguments),this.markDirty(),(r=null!=(n=(t=Structure.prototype.subclasses.InputStructure).prototype.instancesBeingInterpreted)?n.length:void 0)&&(this.origin=t.prototype.instancesBeingInterpreted[r-1])}return extend(e,Structure),e.prototype.className=Structure.addSubclass("OutputStructure",e),e.prototype.markDirty=function(t){return null==t&&(t=!0),this.dirty=t},e.prototype.addConnectionOrigin=function(t,r,n){var o,u,s;if(o=Structure.prototype.subclasses.InputStructure,r instanceof e&&(u=null!=(s=o.prototype.instancesBeingInterpreted)?s.length:void 0))return n._origin=o.prototype.instancesBeingInterpreted[u-1].id()},e.prototype.feedback=function(t){var e;return null!=(e=this.origin)?e.feedback(t):void 0},e.prototype.hasLabel=function(t){return!1},e.lookUpIn=function(t,e){var r,n,o,u;for(n=0,o=(u=e.slice(0).reverse()).length;n<o;n++)if((r=u[n]).hasLabel(t))return r},e.prototype.lookUp=function(t){return this.firstAccessible(function(e){return e.hasLabel(t)})},e.prototype.lookUpAll=function(t){return this.allAccessibles(function(e){return e.hasLabel(t)})},e.prototype.lookUpAllCitations=function(){var t,e,r,n,o,u,s,i,p,c,a,l,h,f,y,d,b,v,O;for(b={premises:{connections:[],labels:[]},reasons:{connections:[],labels:[]}},n=0,p=(f=this.getConnectionsOut()).length;n<p;n++)for(e=f[n],r=this.getConnectionData(e),o=0,c=(y=["premise","reason"]).length;o<c;o++)O=y[o],(null!=r?r.type:void 0)===O+" citation"&&null!=(v=this.getConnectionTarget(e))&&b[O+"s"].connections.push({cited:v.id(),id:e});for(u=0,a=(d=["premise","reason"]).length;u<a;u++)if(O=d[u],(i=this.getAttribute(O+" citations"))&&i instanceof Array)for(h=0,l=i.length;h<l;h++)s=i[h],null!=(t=this.lookUp(s))&&b[O+"s"].labels.push({cited:t.id(),label:s});return b},e.prototype.justChanged=function(){var t;return"function"==typeof(t=e.prototype).instanceJustChanged?t.instanceJustChanged(this):void 0},e}(),OutputExpression=function(t){function e(){var t,r,n,o;n=arguments[0],r=2<=arguments.length?slice.call(arguments,1):[],indexOf.call("int flo str byt sym var".split(" "),n)>=0?(e.__super__.constructor.call(this),this.type=n,this.atomicData=r):"bin"===n?(o=r[0],t=2<=r.length?slice.call(r,1):[],e.__super__.constructor.apply(this,t),this.type=n,this.boundVariables=o):indexOf.call("app att err".split(" "),n)>=0?(e.__super__.constructor.apply(this,r),this.type=n):(e.__super__.constructor.call(this),this.type="err")}return extend(e,OutputStructure),e.prototype.className=Structure.addSubclass("OutputExpression",e),e.prototype.toOpenMath=function(){var t,e,r,n,o,u,s;switch(r=function(){var t,r,n,o;for(o=[],t=0,r=(n=this.children).length;t<r;t++)e=n[t],o.push(e.toOpenMath());return o}.call(this),this.type){case"int":case"flo":case"str":case"byt":case"sym":case"var":return function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(OM[this.type],this.atomicData,function(){});case"app":case"att":case"err":return function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(OM[this.type],r,function(){});case"bin":return s=function(){var t,e,n,u;for(u=[],t=0,e=(n=this.boundVariables).length;t<e;t++)o=n[t],u.push(r[o]);return u}.call(this),u=function(){var t,e,n;for(n=[],o=t=0,e=r.length;0<=e?t<e:t>e;o=0<=e?++t:--t)indexOf.call(this.boundVariables,o)<0&&n.push(o);return n}.call(this),n=r[u[0]],t=r[u[1]],function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(OM.bin,[n].concat(slice.call(s),[t]),function(){});default:throw"Not a valid OpenMath type: "+this.type}},e.fromOpenMath=function(t){var r,n,o;switch(n=function(){var n,o,u,s;for(s=[],n=0,o=(u=t.children).length;n<o;n++)r=u[n],s.push(e.fromOpenMath(r));return s}(),t.type){case"i":return new e("int",t.value);case"f":return new e("flo",t.value);case"st":return new e("str",t.value);case"ba":return new e("byt",t.value);case"sy":return new e("sym",t.name,t.cd,t.uri);case"v":return new e("var",t.name);case"a":return function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(e,["app"].concat(slice.call(n)),function(){});case"bi":return new e("bin",function(){o=[];for(var t=1,e=n.length-1;1<=e?t<e:t>e;1<=e?t++:t--)o.push(t);return o}.apply(this),n);case"e":return function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(e,["err"].concat(slice.call(n)),function(){});default:throw"This should never happen - how did an OMNode instance get type "+t.type+"?"}},e}(),"undefined"!=typeof exports&&null!==exports&&(exports.OutputStructure=OutputStructure);
//# sourceMappingURL=output-structure.js.map
