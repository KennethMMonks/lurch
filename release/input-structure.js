var BasicInputModifier,Dependency,InputExpression,InputModifier,InputRule,InputStructure,OutputRule,OutputStructure,Structure,TemplateRule,ref,extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};"undefined"!=typeof require&&null!==require?(Structure=require("./structure").Structure,ref=require("./output-structure"),OutputStructure=ref.OutputStructure,OutputRule=ref.OutputRule,TemplateRule=ref.TemplateRule):"undefined"!=typeof WorkerGlobalScope&&null!==WorkerGlobalScope?null==WorkerGlobalScope.Structure&&(importScripts("structure.js"),importScripts("output-structure.js")):null!=("undefined"!=typeof self&&null!==self?self.importScripts:void 0)&&null==self.Structure&&(importScripts("release/structure.js"),importScripts("release/output-structure.js")),InputStructure=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,Structure),e.prototype.className=Structure.addSubclass("InputStructure",e),e.prototype.markDirty=function(t){var e;return null==t&&(t=!0),t&&this.alreadyStarted?this.feedback({type:"dirty loop"}):(this.dirty=t,t&&null!=(e=this.parentNode)?e.markDirty():void 0)},e.prototype.addLabels=function(){var t,e,r,n,i,u,o,s,p,a,c;if(c=this.lastInterpretation,null!=(n=this.getAttribute("label targets"))&&n instanceof Array&&(c=function(){var t,e,i;for(i=[],r=t=0,e=c.length;t<e;r=++t)p=c[r],indexOf.call(n,r)>=0&&i.push(p);return i}()),null!=(o=this.getAttribute("label regex"))){for(t=null!=(u=this.getAttribute("label regex flags"))?u:"",o=new RegExp(o,t),s=[],e=0,i=c.length;e<i;e++)a=c[e],s.push(a.hasLabel=function(t){return o.test(t)});return s}},e.prototype.copyCitations=function(){var t,e,r,n,i,u,o,s,p,a,c,l,f,h,d,y,g,S,I,b,m,v;if(v=this.lastInterpretation,null!=(e=this.getAttribute("premise citations")))for(e instanceof Array||(e=[e]),s=0,l=v.length;s<l;s++)(m=v[s]).setAttribute("premise citations",function(){var r,n,i;for(i=[],r=0,n=e.length;r<n;r++)t=e[r],i.push(""+t);return i}());if(null!=(e=this.getAttribute("reason citations")))for(e instanceof Array||(e=[e]),a=0,f=v.length;a<f;a++)(m=v[a]).setAttribute("reason citations",function(){var r,n,i;for(i=[],r=0,n=e.length;r<n;r++)t=e[r],i.push(""+t);return i}());for(g=[],c=0,h=(d=this.getAllConnections()).length;c<h;c++)if(r=d[c],o=this.getConnectionData(r),"premise citation"===(y=null!=o?o.type:void 0)||"reason citation"===y){if(I=this.getConnectionSource(r),m=this.getConnectionTarget(r),!I.alreadyStarted||!m.alreadyStarted)continue;i=0,u=function(){return o.id+"."+i},p=function(t){return function(){var e;for(e=[];null!=t.getConnectionSource(u());)e.push(i++);return e}}(this),g.push(function(){var t,e,i,s;for(s=[],t=0,e=(i=I.citationSources(r)).length;t<e;t++)S=i[t],s.push(function(){var t,e,i,s;for(s=[],e=0,t=(i=m.citationTargets(r)).length;e<t;e++)b=i[e],n=JSON.parse(JSON.stringify(o)),p(),n.id=u(),s.push(S.connectTo(b,n));return s}());return s}())}else g.push(void 0);return g},e.prototype.citationSources=function(t){return this.lastInterpretation},e.prototype.citationTargets=function(t){return this.lastInterpretation},e.prototype.assignCorrespondingIDs=function(){var t,e,r,n,i,u;for(i=[],e=t=0,r=(n=this.lastInterpretation).length;t<r;e=++t)null==(u=n[e]).id()?i.push(u.attr({id:this.id()+"."+e})):i.push(void 0);return i},e.prototype.instancesBeingInterpreted=[],e.prototype.instancesAlreadyStarted=[],e.clearAlreadyStarted=function(){var t,r,n;for(t=0,r=(n=e.prototype.instancesAlreadyStarted).length;t<r;t++)delete n[t].alreadyStarted;return e.prototype.instancesAlreadyStarted=[]},e.prototype.interpret=function(t,e,r){var n,i,u,o,s,p,a,c,l;for(l=new(null!=(c=Structure.prototype.subclasses[this.getAttribute("class")])?c:OutputStructure),i=0,u=0,s=e.length;u<s;u++)for(o=0,p=(n=e[u]).length;o<p;o++)a=n[o],l.insertChild(a,i++);return[l]},e.prototype.recursiveInterpret=function(t,r){var n,i,u,o,s,p,a,c,l,f,h;for(null==t&&(t=[]),null==r&&(r=[]),l=t.length,n=[],s=o=0,a=(f=u=this.children()).length;o<a;s=++o)i=f[s].recursiveInterpret(t,u.slice(s+1)),n.push(i),t=t.concat(i);for(t=t.slice(0,l),e.prototype.instancesBeingInterpreted.push(this),e.prototype.instancesAlreadyStarted.push(this),this.alreadyStarted=!0,this.lastInterpretation=this.interpret(t,n,r),this.assignCorrespondingIDs(),p=0,c=(h=this.lastInterpretation).length;p<c;p++)h[p].trackIDs();return this.addLabels(),this.copyCitations(),e.prototype.instancesBeingInterpreted.pop(),this.markDirty(!1),this.lastInterpretation},e.prototype.feedback=function(t){return t.subject=this.id(),Structure.feedback(t)},e}(),InputExpression=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,InputStructure),e.prototype.className=Structure.addSubclass("InputExpression",e),e.prototype.updateData=function(){var t,e,r,n,i,u,o,s,p;for(this.clearAttributesFromModifiers(),p=[],t=0,n=(u=this.getConnectionsIn()).length;t<n;t++)e=u[t],(s=this.getConnectionSource(e))instanceof InputModifier&&p.push(s);for(p.sort(function(t,e){return t===e?0:t.isEarlierThan(e)?-1:1}),o=[],r=0,i=p.length;r<i;r++)s=p[r],o.push(s.updateDataIn(this));return o},e.prototype.setCameFromModifier=function(t){return this.setAttribute("_from modifier "+t,!0)},e.prototype.getCameFromModifier=function(t){return this.getAttribute("_from modifier "+t)},e.prototype.clearAttributesFromModifiers=function(){var t,e,r;e=this.attributes,r=[];for(t in e)hasProp.call(e,t)&&("_from modifier "===t.slice(0,15)?(delete this.attributes[t],r.push(delete this.attributes[t.slice(15)])):r.push(void 0));return r},e.prototype.setSingleValue=function(t,e){return!this.attributes.hasOwnProperty(t)&&(this.setAttribute(t,e),this.setCameFromModifier(t),!0)},e.prototype.addListItem=function(t,e){var r;return(r=this.getAttribute(t))instanceof Array||(r=[]),this.setAttribute(t,r.concat([e])),this.setCameFromModifier(t)},e.prototype.addSetElement=function(t,e){var r,n,i,u,o;for(r=JSON.stringify(e),o=this.getAttribute(t),this.setCameFromModifier(t),o instanceof Array||(o=[]),n=0,i=o.length;n<i;n++)if(u=o[n],r===JSON.stringify(u))return;return this.setAttribute(t,o.concat([e]))},e}(),Dependency=function(t){function e(){var t;e.__super__.constructor.call(this),this.dependencyContents=function(){var e,r,n;for(n=[],e=0,r=arguments.length;e<r;e++)(t=arguments[e])instanceof OutputStructure&&n.push(t);return n}.apply(this,arguments)}return extend(e,InputExpression),e.prototype.getContents=function(){return this.dependencyContents},e.prototype.interpret=function(t,e,r){return this.getContents()},e.prototype.className=Structure.addSubclass("Dependency",e),e}(),InputRule=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,InputExpression),e.prototype.className=Structure.addSubclass("InputRule",e),e.prototype.interpret=function(t,e,r){var n,i,u,o,s,p,a,c;for(null!=this.validateStep?(a=new OutputRule).validateStep=this.validateStep:(a=new TemplateRule,(c=null!=this.getAttribute("iff"))&&a.setAttribute("iff",c),(c=null!=this.getAttribute("matching type"))&&a.setAttribute("matching type",c)),u=0,s=e.length;u<s;u++)for(o=0,p=(i=e[u]).length;o<p;o++)n=i[o],a.insertChild(n,a.children().length);return[a]},e}(),InputModifier=function(t){function e(){e.__super__.constructor.call(this)}return extend(e,InputStructure),e.prototype.className=Structure.addSubclass("InputModifier",e),e.prototype.insertChild=function(){},e.prototype.interpret=function(t,e,r){return[]},e.prototype.updateConnections=function(){},e.prototype.updateDataIn=function(t){},e}(),BasicInputModifier=function(t){function e(){var t;e.__super__.constructor.call(this),this.actions=function(){var e,r,n,i;for(i=[],e=0,r=arguments.length;e<r;e++)3!==(t=arguments[e]).length||"setSingleValue"!==(n=t[2])&&"addListItem"!==n&&"addSetElement"!==n||i.push(t);return i}.apply(this,arguments)}return extend(e,InputModifier),e.prototype.updateDataIn=function(t){var e,r,n,i,u,o,s,p;for(o=[],e=0,n=(i=this.actions).length;e<n;e++)r=(u=i[e])[0],p=u[1],s=u[2],o.push(t[s](r,p));return o},e.prototype.className=Structure.addSubclass("BasicInputModifier",e),e}(),"undefined"!=typeof exports&&null!==exports&&(exports.InputStructure=InputStructure,exports.InputExpression=InputExpression,exports.InputModifier=InputModifier,exports.BasicInputModifier=BasicInputModifier,exports.Dependency=Dependency);
//# sourceMappingURL=input-structure.js.map
