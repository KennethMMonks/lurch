var Structure,slice=[].slice,indexOf=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1},hasProp={}.hasOwnProperty;exports.Structure=Structure=function(){function t(){var n,e,i,r,o,l;for(i=1<=arguments.length?slice.call(arguments,0):[],this.computedAttributes={},this.externalAttributes={},this.parentNode=null,this.childList=function(){var e,r,o;for(o=[],e=0,r=i.length;e<r;e++)(n=i[e])instanceof t&&o.push(n);return o}(),r=0,o=(l=this.childList).length;r<o;r++)(e=l[r]).removeFromParent(),e.parentNode=this,"function"==typeof e.wasInserted&&e.wasInserted()}return t.prototype.IDs=[],t.instanceWithID=function(n){return t.prototype.IDs[n]},t.nextUnusedID=function(){var n;return(n=t.prototype.IDs.indexOf(null))>=0?n:t.prototype.IDs.length},t.prototype.getID=function(){if(null==this.ID)return this.ID=t.nextUnusedID(),t.prototype.IDs[this.ID]=this},t.prototype.releaseID=function(){var n;if(null!=this.ID){for(t.prototype.IDs[this.ID]=null,delete this.ID,n=[];null===t.prototype.IDs[t.prototype.IDs.length-1];)n.push(t.prototype.IDs.pop());return n}},t.prototype.parent=function(){return this.parentNode},t.prototype.children=function(){return this.childList.slice(0)},t.prototype.indexInParent=function(){var t,n;return null!=(t=this.parentNode)&&null!=(n=t.childList)?n.indexOf(this):void 0},t.prototype.previousSibling=function(){var t;if(null!=(t=this.indexInParent()))return this.parentNode.childList[t-1]},t.prototype.nextSibling=function(){var t;if(null!=(t=this.indexInParent()))return this.parentNode.childList[t+1]},t.prototype.removeFromParent=function(){var t,n;if(null!=(n=this.parentNode))return t=this.indexInParent(),this.parentNode.childList.splice(t,1),this.parentNode=null,"function"==typeof this.wasRemoved?this.wasRemoved(n,t):void 0},t.prototype.removeChild=function(t){var n;return null!=(n=this.childList[t])?n.removeFromParent():void 0},t.prototype.insertChild=function(n,e){if(null==e&&(e=0),n instanceof t&&0<=e&&e<=this.childList.length)return n.removeFromParent(),this.childList=slice.call(this.childList.slice(0,e)).concat([n],slice.call(this.childList.slice(e))),n.parentNode=this,"function"==typeof n.wasInserted?n.wasInserted():void 0},t.prototype.replaceWith=function(t){var n,e;if(null!=(e=this.parentNode))return n=this.indexInParent(),this.removeFromParent(),e.insertChild(t,n)},t.prototype.isEarlierThan=function(n){var e,i,r,o,l,s,u,h;if(n instanceof t){if(n===this)return!1;for(e=[n];null!=(o=e[0].parent());)e.unshift(o);for(h=this,u=null;null!=h&&indexOf.call(e,h)<0;)u=h,h=h.parent();if(null!=h)return h===this||h!==n&&(i=e.indexOf(h),s=e[i+1],r=u.indexInParent(),l=s.indexInParent(),r<l)}},t.prototype.getComputedAttribute=function(t){return this.computedAttributes[t]},t.prototype.setComputedAttribute=function(t,n){if(this.computedAttributes[t]!==n)return this.computedAttributes[t]=n,"function"==typeof this.wasChanged?this.wasChanged():void 0},t.prototype.clearComputedAttributes=function(){var t,n,e,i,r;for(0===(e=1<=arguments.length?slice.call(arguments,0):[]).length&&(e=Object.keys(this.computedAttributes)),r=[],t=0,i=e.length;t<i;t++)(n=e[t])in this.computedAttributes?(delete this.computedAttributes[n],r.push("function"==typeof this.wasChanged?this.wasChanged():void 0)):r.push(void 0);return r},t.prototype.compute=function(){var t,n,e,i,r,o,l;for(l=[],i=0,r=(n=1<=arguments.length?slice.call(arguments,0):[]).length;i<r;i++)(t=n[i])instanceof Array||(t=[t]),e=t[0],o=2<=t.length?slice.call(t,1):[],l.push(this.setComputedAttribute(e,this[e].apply(this,o)));return l},t.prototype.getExternalAttribute=function(t){return this.externalAttributes[t]},t.prototype.setExternalAttribute=function(t,n){if(this.externalAttributes[t]!==n)return this.externalAttributes[t]=n,"function"==typeof this.wasChanged?this.wasChanged():void 0},t.prototype.clearExternalAttributes=function(){var t,n,e,i,r;for(0===(e=1<=arguments.length?slice.call(arguments,0):[]).length&&(e=Object.keys(this.externalAttributes)),r=[],t=0,i=e.length;t<i;t++)(n=e[t])in this.externalAttributes?(delete this.externalAttributes[n],r.push("function"==typeof this.wasChanged?this.wasChanged():void 0)):r.push(void 0);return r},t.prototype.attr=function(t){var n,e;for(n in t)hasProp.call(t,n)&&(e=t[n],this.setExternalAttribute(n,e));return this},t.prototype.setup=function(){var t,n,e,i;return(e=function(t){var n,i,r,o,l;for(t.getID(),l=[],i=0,r=(o=t.children()).length;i<r;i++)n=o[i],l.push(e(n));return l})(this),i={},(n=function(t){var e,r,o,l,s,u;for(null!=(r=t.getExternalAttribute("id"))&&(i[r]=t,t.clearExternalAttributes("id")),u=[],o=0,l=(s=t.children()).length;o<l;o++)e=s[o],u.push(n(e));return u})(this),(t=function(n){var e,r,o,l,s,u,h,c,a,p,f;for(o=0,s=(h=["label","premise","reason"]).length;o<s;o++)e=h[o],null!=(f=n.getExternalAttribute(e+" for"))&&(null!=(p="previous"===f?n.previousSibling():"next"===f?n.nextSibling():i.hasOwnProperty(f)?i[f]:null)&&n.connectTo(p,e),n.clearExternalAttributes(e+" for"));for(a=[],l=0,u=(c=n.children()).length;l<u;l++)r=c[l],a.push(t(r));return a})(this),this.fillOutConnections(),this},t.prototype.fillOutConnections=function(){var n,e,i,r,o,l,s,u,h,c,a,p,f,d,I,g,x,b,v,y,A,D,m,E,O;for(l=0,s=(f=this.childList).length;l<s;l++)f[l].fillOutConnections();if(null!=this.ID){a=function(t){var n,e,i,r,o,l;r=[];for(o in t)if(hasProp.call(t,o)){e=t[o];for(l in e)if(hasProp.call(e,l))for(n=1,i=e[l];1<=i?n<=i:n>=i;1<=i?++n:--n)r.push([Number(o),l])}return r},p=(i=function(t){var n,e,i,r,o,l,s;for(o={},i=0,r=t.length;i<r;i++)l=(e=t[i])[0],s=e[1],null==o[l]&&(o[l]={}),null==(n=o[l])[s]&&(n[s]=0),o[l][s]++;return o})(null!=(d=this.getExternalAttribute("connectionsOut"))?d:[]);for(m in p)if(hasProp.call(p,m)&&(u=p[m],null!=(e=t.instanceWithID(m)))){null==(E=i(null!=(I=e.getExternalAttribute("connectionsIn"))?I:[]))[h=this.ID]&&(E[h]={});for(O in u)hasProp.call(u,O)&&(r=u[O],u[O]=E[this.ID][O]=Math.max(r,null!=(g=E[this.ID][O])?g:0));e.setExternalAttribute("connectionsIn",a(E))}o=i(null!=(x=this.getExternalAttribute("connectionsIn"))?x:[]),y=[];for(A in o)if(hasProp.call(o,A)&&(u=o[A],null!=(n=t.instanceWithID(A)))){null==(D=i(null!=(b=n.getExternalAttribute("connectionsOut"))?b:[]))[c=this.ID]&&(D[c]={});for(O in u)hasProp.call(u,O)&&(r=u[O],u[O]=D[this.ID][O]=Math.max(r,null!=(v=D[this.ID][O])?v:0));y.push(n.setExternalAttribute("connectionsOut",a(D)))}return y}},t.prototype.connectTo=function(n,e){var i,r,o,l;return null!=this.ID&&n instanceof t&&null!=n.ID&&(r=null!=(o=this.getExternalAttribute("connectionsOut"))?o:[],i=null!=(l=n.getExternalAttribute("connectionsIn"))?l:[],r.push([n.ID,e]),i.push([this.ID,e]),this.setExternalAttribute("connectionsOut",r),n.setExternalAttribute("connectionsIn",i),!0)},t.prototype.disconnectFrom=function(n,e){var i,r,o,l,s,u;if(!(null!=this.ID&&n instanceof t&&null!=n.ID))return!1;for(l=null!=(s=this.getExternalAttribute("connectionsOut"))?s:[],r=null!=(u=n.getExternalAttribute("connectionsIn"))?u:[],o=i=0;o<l.length&&(l[o][0]!==n.ID||l[o][1]!==e);)o++;if(o===l.length)return!1;for(;i<r.length&&(r[i][0]!==this.ID||r[i][1]!==e);)i++;return i!==r.length&&(l.splice(o,1),r.splice(i,1),this.setExternalAttribute("connectionsOut",l),n.setExternalAttribute("connectionsIn",r),!0)},t.prototype.allConnectionsOut=function(t){var n,e,i,r,o,l;if(r=null!=(o=this.getExternalAttribute("connectionsOut"))?o:[],null==t)return r;for(l=[],e=0,i=r.length;e<i;e++)(n=r[e])[1]===t&&l.push(n[0]);return l},t.prototype.allConnectionsIn=function(t){var n,e,i,r,o,l;if(e=null!=(o=this.getExternalAttribute("connectionsIn"))?o:[],null==t)return e;for(l=[],i=0,r=e.length;i<r;i++)(n=e[i])[1]===t&&l.push(n[0]);return l},t.prototype.allConnectionsTo=function(n){var e,i,r,o,l,s;if(!(n instanceof t&&null!=n.ID))return null;for(s=[],i=0,r=(o=null!=(l=this.getExternalAttribute("connectionsOut"))?l:[]).length;i<r;i++)(e=o[i])[0]===n.ID&&s.push(e[1]);return s},t.prototype.properties=function(){var n,e,i,r,o,l,s,u;for(s={},e=0,i=(l=null!=(o=this.getExternalAttribute("connectionsIn"))?o:[]).length;e<i;e++)n=l[e],null!=(u=t.instanceWithID(n[0]))&&(null!=s[r=n[1]]?s[r]:s[r]=[]).push(u);return s},t}();
//# sourceMappingURL=structure.js.map
