var Structure,slice=[].slice,indexOf=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1},hasProp={}.hasOwnProperty;Structure=function(){function t(){var t,n,e,i;for(n=1<=arguments.length?slice.call(arguments,0):[],this.externalAttributes={},this.parentNode=null,this.childList=[],e=0,i=n.length;e<i;e++)t=n[e],this.insertChild(t,this.childList.length)}var n,e;return t.prototype.subclasses={},t.addSubclass=function(n,e){return t.prototype.subclasses[n]=e,n},t.prototype.className=t.addSubclass("Structure",t),t.prototype.toJSON=function(t){var n,e;return null==t&&(t=!0),t||null==this.id()?e=this.externalAttributes:delete(e=JSON.parse(JSON.stringify(this.externalAttributes))).id,{className:this.className,externalAttributes:e,children:function(){var e,i,r,l;for(l=[],e=0,i=(r=this.childList).length;e<i;e++)n=r[e],l.push(n.toJSON(t));return l}.call(this)}},t.fromJSON=function(n){var e,i,r,l;return r=t.prototype.subclasses[n.className],i=function(){var i,r,l,s;for(s=[],i=0,r=(l=n.children).length;i<r;i++)e=l[i],s.push(t.fromJSON(e));return s}(),l=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(r,i,function(){}),l.externalAttributes=JSON.parse(JSON.stringify(n.externalAttributes)),l},t.prototype.parent=function(){return this.parentNode},t.prototype.children=function(){return this.childList.slice(0)},t.prototype.indexInParent=function(){var t,n;return null!=(t=this.parentNode)&&null!=(n=t.childList)?n.indexOf(this):void 0},t.prototype.previousSibling=function(){var t;if(null!=(t=this.indexInParent()))return this.parentNode.childList[t-1]},t.prototype.nextSibling=function(){var t;if(null!=(t=this.indexInParent()))return this.parentNode.childList[t+1]},t.prototype.copy=function(){var n,e,i,r,l;for((e=new t).externalAttributes=JSON.parse(JSON.stringify(this.externalAttributes)),e.childList=function(){var t,e,i,r;for(r=[],t=0,e=(i=this.childList).length;t<e;t++)n=i[t],r.push(n.copy());return r}.call(this),i=0,r=(l=e.childList).length;i<r;i++)l[i].parentNode=e;return e},t.prototype.isEarlierThan=function(n){var e,i,r,l,s,o,u,h;if(n instanceof t){if(n===this)return!1;for(e=[n];null!=(l=e[0].parent());)e.unshift(l);for(h=this,u=null;null!=h&&indexOf.call(e,h)<0;)u=h,h=h.parent();if(null!=h)return h===this||h!==n&&(i=e.indexOf(h),o=e[i+1],r=u.indexInParent(),s=o.indexInParent(),r<s)}},t.prototype.removeFromParent=function(){var t,n;if(null!=(n=this.parentNode))return"function"==typeof this.willBeRemoved&&this.willBeRemoved(),t=this.indexInParent(),this.parentNode.childList.splice(t,1),this.parentNode=null,"function"==typeof this.wasRemoved?this.wasRemoved(n,t):void 0},t.prototype.removeChild=function(t){var n;return null!=(n=this.childList[t])?n.removeFromParent():void 0},t.prototype.insertChild=function(n,e){var i;if(null==e&&(e=0),n instanceof t&&n!==this&&0<=e&&e<=this.childList.length){for(i=this;null!=(i=i.parent());)if(i===n){this.removeFromParent();break}return n.removeFromParent(),"function"==typeof n.willBeInserted&&n.willBeInserted(this,e),this.childList.splice(e,0,n),n.parentNode=this,"function"==typeof n.wasInserted?n.wasInserted():void 0}},t.prototype.replaceWith=function(t){var n,e;if(null!=(e=this.parentNode))return n=this.indexInParent(),this.removeFromParent(),e.insertChild(t,n)},t.prototype.getExternalAttribute=function(t){return this.externalAttributes[t]},t.prototype.setExternalAttribute=function(t,n){if(this.externalAttributes[t]!==n)return"function"==typeof this.willBeChanged&&this.willBeChanged(t),this.externalAttributes[t]=n,"function"==typeof this.wasChanged?this.wasChanged(t):void 0},t.prototype.clearExternalAttributes=function(){var t,n,e,i,r;for(0===(e=1<=arguments.length?slice.call(arguments,0):[]).length&&(e=Object.keys(this.externalAttributes)),r=[],t=0,i=e.length;t<i;t++)(n=e[t])in this.externalAttributes?("function"==typeof this.willBeChanged&&this.willBeChanged(n),delete this.externalAttributes[n],r.push("function"==typeof this.wasChanged?this.wasChanged(n):void 0)):r.push(void 0);return r},t.prototype.attr=function(t){var n,e;for(n in t)hasProp.call(t,n)&&(e=t[n],this.setExternalAttribute(n,e));return this},t.prototype.setup=function(){var t,n,e;return e={},(n=function(t){var i,r,l,s,o,u;for(null!=(r=t.getExternalAttribute("id"))&&(e[r]=t),u=[],l=0,s=(o=t.children()).length;l<s;l++)i=o[l],u.push(n(i));return u})(this),(t=function(n){var i,r,l,s,o,u,h,c,a,p,f;for(l=0,o=(h=["label","premise","reason"]).length;l<o;l++)i=h[l],null!=(f=n.getExternalAttribute(i+" for"))&&(null!=(p="previous"===f?n.previousSibling():"next"===f?n.nextSibling():e.hasOwnProperty(f)?e[f]:null)&&n.connectTo(p,i),n.clearExternalAttributes(i+" for"));for(a=[],s=0,u=(c=n.children()).length;s<u;s++)r=c[s],a.push(t(r));return a})(this),this.fillOutConnections(),this},t.prototype.IDs={},t.instanceWithID=function(n){return t.prototype.IDs[n]},t.prototype.id=function(){return this.getExternalAttribute("id")},t.prototype.trackIDs=function(n){var e,i,r,l,s;if(null==n&&(n=!0),null!=this.id()&&(t.prototype.IDs[this.id()]=this),n){for(s=[],i=0,r=(l=this.children()).length;i<r;i++)e=l[i],s.push(e.trackIDs());return s}},t.prototype.untrackIDs=function(n){var e,i,r,l,s;if(null==n&&(n=!0),null!=this.id()&&delete t.prototype.IDs[this.id()],n){for(s=[],i=0,r=(l=this.children()).length;i<r;i++)e=l[i],s.push(e.untrackIDs());return s}},t.prototype.clearIDs=function(t){var n,e,i,r,l;if(null==t&&(t=!0),this.clearExternalAttributes("id"),t){for(l=[],e=0,i=(r=this.children()).length;e<i;e++)n=r[e],l.push(n.clearIDs());return l}},t.prototype.fillOutConnections=function(){var n,e,i,r,l,s,o,u,h,c,a,p,f,d,b,g,x,v,y,A,O,I,S,E,m;for(s=0,o=(f=this.childList).length;s<o;s++)f[s].fillOutConnections();if(null!=this.id()){a=function(t){var n,e,i,r,l,s;r=[];for(l in t)if(hasProp.call(t,l)){e=t[l];for(s in e)if(hasProp.call(e,s))for(n=1,i=e[s];1<=i?n<=i:n>=i;1<=i?++n:--n)r.push([l,s])}return r},p=(i=function(t){var n,e,i,r,l,s,o;for(l={},i=0,r=t.length;i<r;i++)s=(e=t[i])[0],o=e[1],null==l[s]&&(l[s]={}),null==(n=l[s])[o]&&(n[o]=0),l[s][o]++;return l})(null!=(d=this.getExternalAttribute("connectionsOut"))?d:[]);for(S in p)if(hasProp.call(p,S)&&(u=p[S],null!=(e=t.instanceWithID(S)))){null==(E=i(null!=(b=e.getExternalAttribute("connectionsIn"))?b:[]))[h=this.id()]&&(E[h]={});for(m in u)hasProp.call(u,m)&&(r=u[m],u[m]=E[this.id()][m]=Math.max(r,null!=(g=E[this.id()][m])?g:0));e.setExternalAttribute("connectionsIn",a(E))}l=i(null!=(x=this.getExternalAttribute("connectionsIn"))?x:[]),A=[];for(O in l)if(hasProp.call(l,O)&&(u=l[O],null!=(n=t.instanceWithID(O)))){null==(I=i(null!=(v=n.getExternalAttribute("connectionsOut"))?v:[]))[c=this.id()]&&(I[c]={});for(m in u)hasProp.call(u,m)&&(r=u[m],u[m]=I[this.id()][m]=Math.max(r,null!=(y=I[this.id()][m])?y:0));A.push(n.setExternalAttribute("connectionsOut",a(I)))}return A}},t.prototype.connectTo=function(n,e){var i,r,l,s;return null==e&&(e=""),null!=this.id()&&n instanceof t&&null!=n.id()&&(r=null!=(l=this.getExternalAttribute("connectionsOut"))?l:[],i=null!=(s=n.getExternalAttribute("connectionsIn"))?s:[],r.push([n.id(),e]),i.push([this.id(),e]),this.setExternalAttribute("connectionsOut",r),n.setExternalAttribute("connectionsIn",i),!0)},t.prototype.disconnectFrom=function(n,e){var i,r,l,s,o,u;if(null==e&&(e=""),!(null!=this.id()&&n instanceof t&&null!=n.id()))return!1;for(s=null!=(o=this.getExternalAttribute("connectionsOut"))?o:[],r=null!=(u=n.getExternalAttribute("connectionsIn"))?u:[],l=i=0;l<s.length&&(s[l][0]!==n.id()||s[l][1]!==e);)l++;if(l===s.length)return!1;for(;i<r.length&&(r[i][0]!==this.id()||r[i][1]!==e);)i++;return i!==r.length&&(s.splice(l,1),r.splice(i,1),this.setExternalAttribute("connectionsOut",s),n.setExternalAttribute("connectionsIn",r),!0)},t.prototype.allConnectionsOut=function(t){var n,e,i,r,l,s;if(r=null!=(l=this.getExternalAttribute("connectionsOut"))?l:[],null==t)return r;for(s=[],e=0,i=r.length;e<i;e++)(n=r[e])[1]===t&&s.push(n[0]);return s},t.prototype.allConnectionsIn=function(t){var n,e,i,r,l,s;if(e=null!=(l=this.getExternalAttribute("connectionsIn"))?l:[],null==t)return e;for(s=[],i=0,r=e.length;i<r;i++)(n=e[i])[1]===t&&s.push(n[0]);return s},t.prototype.allConnectionsTo=function(n){var e,i,r,l,s,o;if(!(n instanceof t&&null!=n.id()))return null;for(o=[],i=0,r=(l=null!=(s=this.getExternalAttribute("connectionsOut"))?s:[]).length;i<r;i++)(e=l[i])[0]===n.id()&&o.push(e[1]);return o},t.prototype.isAccessibleTo=function(n){return n instanceof t&&(null!=n.parent()&&(this.parent()===n.parent()?this.indexInParent()<n.indexInParent():this.isAccessibleTo(n.parent())))},t.prototype.isInTheScopeOf=function(t){return t.isAccessibleTo(this)},t.prototype.iteratorOverAccessibles=function(){return{ancestor:this,sibling:this,next:function(){return null==this.ancestor?null:null!=(this.sibling=this.sibling.previousSibling())?this.sibling:(this.sibling=this.ancestor=this.ancestor.parent(),this.next())}}},t.prototype.iteratorOverScope=function(){return{chain:[this],next:function(){var t,n;if(0===this.chain.length)return null;if(t=this.chain.pop(),null!=(n=t.nextSibling())){for(this.chain.push(n);null!=(n=n.children()[0]);)this.chain.push(n);return this.chain[this.chain.length-1]}return this.chain.length>0?this.chain[this.chain.length-1]:null}}},e=function(t,n){var e;for(null==n&&(n=function(){return!0});null!=(e=t.next());)if(n(e))return e},n=function(t,n){var e,i;for(null==n&&(n=function(){return!0}),i=[];null!=(e=t.next());)n(e)&&i.push(e);return i},t.prototype.firstAccessible=function(t){return null==t&&(t=function(){return!0}),e(this.iteratorOverAccessibles(),t)},t.prototype.allAccessibles=function(t){return null==t&&(t=function(){return!0}),n(this.iteratorOverAccessibles(),t)},t.prototype.firstInScope=function(t){return null==t&&(t=function(){return!0}),e(this.iteratorOverScope(),t)},t.prototype.allInScope=function(t){return null==t&&(t=function(){return!0}),n(this.iteratorOverScope(),t)},t}(),"undefined"!=typeof exports&&null!==exports&&(exports.Structure=Structure);
//# sourceMappingURL=structure.js.map
